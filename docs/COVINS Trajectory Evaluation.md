![image](https://github.com/user-attachments/assets/2b460eae-3719-4f38-bab0-8808c5d7186e)# COVINS Trajectory Evaluation with evo

This README documents the evaluation process for multi-agent SLAM trajectories generated by COVINS, using the [evo](https://github.com/MichaelGrupp/evo) tool. It includes instructions for exporting trajectories, converting and synchronizing ground truth, running evaluations, and interpreting results.

---

## 📤 Output Files

COVINS automatically saves each agent's estimated trajectory in:

```
covins_backend/output/KF_<AGENT_ID>_<FORMAT>.csv
```

You can copy them from Docker with:

```bash
docker cp <container_id>:/root/covins_ws/src/covins/covins_backend/output /host/path/to/output
```

### Supported Formats

Set via `trajectory_format` in `config_backend.yaml`:

* **TUM format** (default):
  `timestamp[s] t_x t_y t_z q_x q_y q_z q_w`
* **EuRoC format**:
  `timestamp[ns], t_x, t_y, t_z, q_w, q_x, q_y, q_z, vel_x, vel_y, vel_z, bias_gyro_*, bias_acc_*`

Output files include suffixes `_ftum.csv` or `_feuroc.csv`.

### Combining Trajectories

* Combine multiple agents into one estimate:

  ```bash
  cat KF_0_ftum.csv KF_1_ftum.csv KF_2_ftum.csv > mh123_est.csv
  ```
* Or use the combined file:
  `stamped_traj_estimate.txt`

### Ground Truth

* Located in: `<sequence>/mav0/state_groundtruth_estimate0/data.csv`
* Merge multiple GT files manually (remove duplicate headers).

---

## 📐 Evaluation with `evo`


### Evaluate with APE (Absolute Pose Error)

#### 📊 Result Interpretation

What do these metrics mean?

| Metric     | Description                                          |
| ---------- | ---------------------------------------------------- |
| **Max**    | Worst-case translation error (in meters)             |
| **Mean**   | Average translation error across all timestamps      |
| **Median** | Middle error value – robust to outliers              |
| **Min**    | Best-case accuracy (lowest error observed)           |
| **RMSE**   | Root Mean Square Error – balances large/small errors |
| **Std**    | Standard deviation – how much the error varies       |


#### 🔹 Without GBA:

```bash
evo_ape euroc mh123_gt.csv mh123_est.csv -va --save_results results/without_gba.zip --plot
```
| Metric | Value (m) |
| ------ | --------- |
| Max    |  0.1529 m |
| Mean   | 0.0639 m  |
| Median | 0.0611 m  |
| Min    | 0.0067 m  |
| Std    | 0.0286 m  |


![Screenshot from 2025-05-08 10-38-31](https://github.com/user-attachments/assets/7742a991-09ad-48a4-b366-1b72f2d3c753)
![image](https://github.com/user-attachments/assets/6f542768-4b33-442a-a6d7-98bf0a21888f)
This 3D plot visualizes the Absolute Pose Error (APE) along the estimated trajectory, with color indicating the magnitude of translation error. Most of the trajectory appears in deep blue to cyan (error < 8 cm), suggesting high spatial accuracy. A few localized segments in yellow and red indicate slightly higher deviations (up to ~15 cm), often in areas with sharp turns or less visual information. The smooth, symmetric loops and overall compact error distribution reflect the strong performance of the global bundle adjustment.

#### 🔹 With GBA:

```bash
evo_ape euroc mh123_gt.csv mh123_est_gba.csv -va --save_results results/with_gba.zip --plot
```
| Metric | Value (m) |
| ------ | --------- |
| Max    |  0.1065 m |
| Mean   | 0.0199 m  |
| Median | 0.0174 m  |
| Min    |  0.0028 m |
| RMSE   | 0.0227 m  |
| Std    | 0.0108 m  |


![Screenshot from 2025-05-08 11-13-40](https://github.com/user-attachments/assets/ca26a449-7f5f-45c9-b6eb-84ab76438103)
![image](https://github.com/user-attachments/assets/aa1cc3ce-2211-4c7d-a969-27439538878e)
In this 3D error map, the estimated trajectory closely follows the reference, with most segments appearing in dark blue (APE < 5 cm). The color scale indicates a significantly reduced error range compared to the version without GBA. Minimal presence of green or yellow highlights suggests that global bundle adjustment successfully minimized drift and aligned the trajectory consistently throughout the entire sequence.


#### compare results:
```evo_res results/*.zip -p --save_table results/table.csv```
📊 Comparison Table

| File                | RMSE   | Mean   | Median | Std    | Min    | Max    | SSE    |
| ------------------- | ------ | ------ | ------ | ------ | ------ | ------ | ------ |
| mh123\_est.csv      | 0.0700 | 0.0639 | 0.0611 | 0.0286 | 0.0067 | 0.1529 | 1.4707 |
| mh123\_est\_gba.csv | 0.0228 | 0.0200 | 0.0175 | 0.0109 | 0.0029 | 0.1066 | 0.3677 |

> 🔍 The results clearly show that enabling GBA reduces the mean APE from 6.4 cm to 2.0 cm, and the RMSE from 7 cm to 2.3 cm — significantly improving global consistency.

![image](https://github.com/user-attachments/assets/e30e18df-e9aa-47e5-8e8c-153a111851c5)



🔍 **Insights:**

* Low RMSE and mean APE (< 2 cm) indicate high trajectory accuracy.
* The Sim(3) alignment corrects for rotation, translation, and scale.
* The color-coded map view shows where error is concentrated (usually edges).

---

## 📌 Summary

* Estimated trajectories must be in **TUM** format for `evo_ape`.
* Ground truth can be in **EuRoC** or **TUM**.
* Use `--align --correct_scale` to compensate for initialization and scale drift.
* Sync timestamps carefully for  visualization.
* Use `evo_res` for batch comparisons.

---

📂 For visual examples and screenshots, refer to the attached image assets in this repo.








### Convert GT from EuRoC to TUM format

Use a Python script to:

1. Select: `timestamp, t_x, t_y, t_z, q_x, q_y, q_z, q_w`
2. Convert timestamp from nanoseconds to seconds
3. Sync with estimated trajectory timestamps (rounded to 3 decimal places)
4. Save as `mh123_gt_tum_synced.txt`

#### After syncing GT and converting to TUM:

#### 🔹 without GBA:
 ```evo_ape tum mh123_gt_tum_synced.txt mh123_est.csv --align --correct_scale -p --plot_mode xz```

 | Metric | Value (m) |
| ------ | --------- |
| Max    | 0.120097  |
| Mean   | 0.048176  |
| Median | 0.042595  |
| Min    | 0.019948  |
| RMSE   | 0.053570  |
| SSE    | 0.083221  |
| Std    | 0.023425  |

   ![image](https://github.com/user-attachments/assets/fb5f7cd2-2fae-427c-86b8-ff6917f62507)
   ![image](https://github.com/user-attachments/assets/3d299a04-9363-45f1-ad2d-e4c30f7de4ff)
The spatial APE plots show that most of the estimated trajectory maintains low error (2–7 cm), especially in the central segments. However, local spikes in error are visible at trajectory edges, often due to abrupt motion or visually ambiguous regions. The time-based APE graph confirms this consistency, with the mean and RMSE around 5–6 cm and only a few short-lived deviations. These results suggest good global alignment, but with room for improvement in handling challenging regions (e.g., by enhancing visual tracking or incorporating loop closures).



#### 🔹 with GBA
```evo_ape tum mh123_gt_tum_synced.txt mh123_est_gba.csv --align --correct_scale -p --plot_mode xz```

| Metric | Value (m) |
| ------ | --------- |
| Max    | 0.090646  |
| Mean   | 0.016981  |
| Median | 0.014023  |
| Min    | 0.002275  |
| RMSE   | 0.020107  |
| SSE    | 0.286655  |
| Std    | 0.010768  |

![image](https://github.com/user-attachments/assets/c5a355c1-f416-489c-8710-737935a83c4e)
![image](https://github.com/user-attachments/assets/dd38fcd3-088d-4fff-a896-27dc0cb47e77)


---












---
