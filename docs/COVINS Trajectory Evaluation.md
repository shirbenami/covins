# COVINS Trajectory Evaluation with evo

This README documents the evaluation process for multi-agent SLAM trajectories generated by COVINS, using the [evo](https://github.com/MichaelGrupp/evo) tool. It includes instructions for exporting trajectories, converting and synchronizing ground truth, running evaluations, and interpreting results.

---

## ğŸ“¤ Output Files

COVINS automatically saves each agent's estimated trajectory in:

```
covins_backend/output/KF_<AGENT_ID>_<FORMAT>.csv
```

You can copy them from Docker with:

```bash
docker cp <container_id>:/root/covins_ws/src/covins/covins_backend/output /host/path/to/output
```

### Supported Formats

Set via `trajectory_format` in `config_backend.yaml`:

* **TUM format** (default):
  `timestamp[s] t_x t_y t_z q_x q_y q_z q_w`
* **EuRoC format**:
  `timestamp[ns], t_x, t_y, t_z, q_w, q_x, q_y, q_z, vel_x, vel_y, vel_z, bias_gyro_*, bias_acc_*`

Output files include suffixes `_ftum.csv` or `_feuroc.csv`.

### Combining Trajectories

* Combine multiple agents into one estimate:

  ```bash
  cat KF_0_ftum.csv KF_1_ftum.csv KF_2_ftum.csv > mh123_est.csv
  ```
* Or use the combined file:
  `stamped_traj_estimate.txt`

### Ground Truth

* Located in: `<sequence>/mav0/state_groundtruth_estimate0/data.csv`
* Merge multiple GT files manually (remove duplicate headers).

---

## ğŸ“ Evaluation with `evo`


### Evaluate with APE (Absolute Pose Error)

#### ğŸ”¹ Without GBA:

```bash
evo_ape euroc mh123_gt.csv mh123_est.csv -va --save_results results/without_gba.zip --plot
```
![image](https://github.com/user-attachments/assets/8b854b70-94ec-4315-9576-fbcedb1ef708)
![Screenshot from 2025-05-08 10-38-31](https://github.com/user-attachments/assets/7742a991-09ad-48a4-b366-1b72f2d3c753)

#### ğŸ”¹ With GBA:

```bash
evo_ape euroc mh123_gt.csv mh123_est_gba.csv -va --save_results results/with_gba.zip --plot
```
![image](https://github.com/user-attachments/assets/c67a403d-ad2a-4ed8-a011-663beb53a01d)
![Screenshot from 2025-05-08 11-13-40](https://github.com/user-attachments/assets/ca26a449-7f5f-45c9-b6eb-84ab76438103)

compare:
```evo_res results/*.zip -p --save_table results/table.csv```
![image](https://github.com/user-attachments/assets/3217905b-610c-44f5-a1f2-23e1d24ad9ff)

![image](https://github.com/user-attachments/assets/e30e18df-e9aa-47e5-8e8c-153a111851c5)


### Convert GT from EuRoC to TUM format

Use a Python script to:

1. Select: `timestamp, t_x, t_y, t_z, q_x, q_y, q_z, q_w`
2. Convert timestamp from nanoseconds to seconds
3. Sync with estimated trajectory timestamps (rounded to 3 decimal places)
4. Save as `mh123_gt_tum_synced.txt`

#### ğŸ”¹ After syncing GT and converting to TUM:

1. without GBA:
 ```evo_ape tum mh123_gt_tum_synced.txt mh123_est.csv --align --correct_scale -p --plot_mode xz```

   ![image](https://github.com/user-attachments/assets/fb5f7cd2-2fae-427c-86b8-ff6917f62507)
   ![image](https://github.com/user-attachments/assets/3d299a04-9363-45f1-ad2d-e4c30f7de4ff)
![image](https://github.com/user-attachments/assets/aead3794-6370-496a-be62-a83c882624c6)


3. with GBA
```evo_ape tum mh123_gt_tum_synced.txt mh123_est_gba.csv --align --correct_scale -p --plot_mode xz```
![image](https://github.com/user-attachments/assets/c5a355c1-f416-489c-8710-737935a83c4e)
![image](https://github.com/user-attachments/assets/dd38fcd3-088d-4fff-a896-27dc0cb47e77)
![image](https://github.com/user-attachments/assets/442e3f87-2945-4682-bf95-c2bcafbf25bc)

---

ğŸ” **Insights:**

* Low RMSE and mean APE (< 2 cm) indicate high trajectory accuracy.
* The Sim(3) alignment corrects for rotation, translation, and scale.
* The color-coded map view shows where error is concentrated (usually edges).

---

## ğŸ“Œ Summary

* Estimated trajectories must be in **TUM** format for `evo_ape`.
* Ground truth can be in **EuRoC** or **TUM**.
* Use `--align --correct_scale` to compensate for initialization and scale drift.
* Sync timestamps carefully for  visualization.
* Use `evo_res` for batch comparisons.

---

ğŸ“‚ For visual examples and screenshots, refer to the attached image assets in this repo.
